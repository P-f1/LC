"use strict";function metadataToModel(e){var t=JSON.parse(e);console.log(t.data.data);for(var n={nodes:[],edges:[]},a=0,r=t.data.data.edgeTypes;a<r.length;a++){var o=r[a];"$"!==o.name[0]&&n.edges.push(buildEdge(o))}for(var i=0,l=t.data.data.nodeTypes;i<l.length;i++){var u=l[i];n.nodes.push(buildNode(u))}return console.log(n),n}function buildNode(e){for(var t={name:e.name,key:[],attributes:[]},n=0,a=e.pkeyAttributeDescriptors;n<a.length;n++){var r=a[n];t.key.push(buildPKey(r))}for(var o=0,i=e.attributeDescriptors;o<i.length;o++){var l=i[o];t.attributes.push(buildAttribute(l))}return t}function buildEdge(e){for(var t={name:e.name,from:e.fromNodeType.name,to:e.toNodeType.name,attributes:[]},n=0,a=e.attributeDescriptors;n<a.length;n++){var r=a[n];t.attributes.push(buildAttribute(r))}return t}function buildPKey(e){return e.name}function buildAttribute(e){return{name:e.name,type:populateAttributeType(e.type)}}function populateAttributeType(e){switch(e){case 0:return"Invalid";case 1:return"Boolean";case 2:return"Byte";case 3:return"Char";case 4:return"Short";case 5:return"Integer";case 6:return"Long";case 7:return"Float";case 8:return"Double";case 9:return"Number";case 10:return"String";case 11:return"Date";case 12:return"Time";case 13:return"TimeStamp";case 14:return"Blob";case 15:return"Clob";default:return"String"}}var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),__decorate=this&&this.__decorate||function(e,t,n,a){var r,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(i=(o<3?r(i):o>3?r(t,n,i):r(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(e,t){return function(n,a){t(n,a,e)}};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),http_1=require("@angular/http"),wi_contrib_1=require("wi-studio/app/contrib/wi-contrib"),contrib_1=require("wi-studio/common/models/contrib"),Observable_1=require("rxjs/Observable"),validation_1=require("wi-studio/common/models/validation"),TibcoGraphContribution=function(e){function t(t,n){var a=e.call(this,t,n)||this;return a.http=n,a.value=function(e,t){console.log("[GraphBuilder:Connector:value] Build field : ",e),console.log(t);var n=t.getField("modelSource"),r=t.getField("model");if("metadata"===e){if("TGDB"===n.value)return Observable_1.Observable.create(function(e){var n=t.getField("url");a.http.get(n.value).subscribe(function(t){e.next(JSON.stringify(metadataToModel(t.text()))),e.complete()})});if(r.value){var o=r.value.content;return o&&(o=o.substr(o.indexOf(",")+1),o=atob(o)),console.log("content = "+o),o}}return null},a.validate=function(e,t){console.log("------------- validate --------------"),console.log(t),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> name = "+e);var n=t.getField("modelSource");t.getField("metadata");return console.log(n),"url"===e?"TGDB"===n.value?validation_1.ValidationResult.newValidationResult().setVisible(!0):validation_1.ValidationResult.newValidationResult().setVisible(!1):"model"===e?"Local File"===n.value?validation_1.ValidationResult.newValidationResult().setVisible(!0):validation_1.ValidationResult.newValidationResult().setVisible(!1):"metadata"===e?validation_1.ValidationResult.newValidationResult().setVisible(!1):"Connect"===e?validation_1.ValidationResult.newValidationResult().setReadOnly(!1):null},a.action=function(e,t){return"Connect"==e?(console.log("------------- action click connect --------------"),Observable_1.Observable.create(function(e){var n=t.getField("model"),a=t.getField("metadata"),r=t.getField("modelSource");"Local File"===r.value?console.log("content = "+n.value):"TGDB"===r.value&&console.log("metadata = "+a.value);var o={context:t,authType:wi_contrib_1.AUTHENTICATION_TYPE.BASIC,authData:{}};e.next(contrib_1.ActionResult.newActionResult().setSuccess(!0).setResult(o))})):null},a}return __extends(t,e),t=__decorate([wi_contrib_1.WiContrib({}),core_1.Injectable(),__param(0,core_1.Inject(core_1.Injector)),__metadata("design:paramtypes",[Object,http_1.Http])],t)}(wi_contrib_1.WiServiceHandlerContribution);exports.TibcoGraphContribution=TibcoGraphContribution;